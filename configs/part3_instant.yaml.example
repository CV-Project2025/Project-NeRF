# ==============================================================================
# Part 3: Dynamic NeRF (D-NeRF) 使用 instant 的配置文件
# ==============================================================================
mode: part3

# ==============================================================================
# 数据配置
# ==============================================================================
downscale: 2 # 图像下采样
white_bkgd: true # 白色背景
scene_scale: 1.0 # 场景缩放

# ==============================================================================
# 渲染配置
# ==============================================================================
near: 2.0 # 光线近裁剪面
far: 6.0 # 光线远裁剪面
n_samples: 128 # ⭐ 训练采样点数
render_n_samples: 128 # ⭐评估采样点数
batch_size: 8192 # ⭐ 训练批大小
chunk: 10000 # ⭐ 渲染分块

# ==============================================================================
# 训练配置
# ==============================================================================
train_iters: 40000 # ⭐ 训练总步数
learning_rate: 0.005 # 初始学习率
weight_decay: 0.00001 # AdamW 权重衰减
eta_min: 0.0001 # Cosine LR 最小值
max_grad_norm: 1.0 # 梯度裁剪
use_amp: true # 混合精度训练

log_every: 50 # 训练日志频率
val_every: 500 # 验证频率

# ==============================================================================
# 正则化配置
# ==============================================================================
deformation_reg_weight: 0.01 # 变形场 L2 正则化
tv_loss_weight: 0.00001 # TV Loss（消除 HashGrid 噪声）
use_temporal_smooth: true # 时间平滑正则化
temporal_smooth_weight: 0.0001 # 时间平滑权重
temporal_epsilon: 0.02 # 时间扰动 ε
temporal_n_samples: 256 # 采样点数

# ==============================================================================
# 数据增强配置
# ==============================================================================
use_coord_noise: true # 坐标噪声（强制变形场平滑）
coord_noise_std: 0.005 # 空间噪声标准差
time_noise_std: 0.04 # 时间噪声标准差
use_random_bg: true # 随机背景（解耦前景/背景）
random_bg_start: 1000 # 随机背景启动步数
use_unsupervised_consistency: true # 无监督一致性（体积守恒）
unsup_consistency_weight: 0.001 # 一致性权重
unsup_n_samples: 512 # 采样点数

# ==============================================================================
# 网络架构配置
# ==============================================================================
L_embed_time: 10 # 时间编码频率
L_embed: 10 # 空间编码频率
deform_hidden_dim: 128 # 变形网络隐藏层维度
deform_num_layers: 4 # 变形网络层数

canonical_type: instant # ⭐ 规范空间类型

# Instant-NGP HashGrid 配置
n_levels: 16 # 哈希网格层数
n_features_per_level: 2 # 每层特征维度
log2_hashmap_size: 19 # 哈希表大小
base_resolution: 16 # 最粗层分辨率
per_level_scale: 1.5 # 层间增长因子
scene_bound: 1.5 # ⭐ 场景边界（决定相机环绕半径 = scene_bound × 2.0）
hidden_dim: 64 # 解码器隐藏层维度

# Density Grid 配置
use_density_grid: true # 空间跳过加速
grid_resolution: 128 # 网格分辨率
grid_threshold: 0.01 # 密度阈值
grid_update_interval: 32 # 更新间隔
grid_warmup_iters: 256 # 预热步数
grid_stop_ratio: 0.9 # 停止更新比例（90%步后冻结网格）

# ==============================================================================
# 输出与视频配置
# ==============================================================================
log_dir: "output/part3" # 输出根目录

# 视频渲染配置（--render_n -1 时生效）
video_frames: 300 # ⭐ 视频总帧数（300帧@24fps=12.5秒）
n_rotations: 1.5 # ⭐ 相机旋转圈数
scene_center: [0.0, 0.0, 0.0] # ⭐ 场景中心（根据物体位置调整）
camera_height: 2.4 # ⭐ 相机高度
camera_radius: 3.0 # ⭐ 相机环绕半径（俯视远景增大，特写减小）
